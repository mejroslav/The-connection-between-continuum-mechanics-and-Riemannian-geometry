\chapter{The connection between Riemannian geometry and Hamiltonian mechanics}

In this chapter we shall prove the theorem of the connection between the hydrodynamic Poisson bracket and the metrics found in the homogeneous system of hydrodynamic type. The original result was given by Dubrovin and Novikov and can be found in \cite{Dubrovin-Novikov}. The proof itself and the preceding lemmas are based on a considerable amount of technical computations, which we shall clarify in detail in order to offer the reader a comprehensive understanding of the chapter in question.



\section{Systems of hydrodynamic type}

\begin{definition}[Homogeneous system of hydrodynamic type]
    A homogeneous system of hydrodynamic type is an equation of the form
    \begin{align}
        \label{eq:h-system}
        \pder{u^i}{t} = f_j^{i \alpha} (u) \pder{u^j}{x^\alpha} 
    \end{align}
    where $u^i(t,x^\alpha)$ are unknown functions, $i = 1, \dots , N$, $\alpha = 1, \dots , d$.
\end{definition}

Sometimes we refer to the number of equations $N$ as the dimension of the hydrodynamical phase space and to the number of spatial variables $d$ as the dimension of the configuration space.

\todo[inline]{Příklad asi přesunout do jiné kapitoly.}
Before we go any further, let us present a few examples.

\begin{example}
    The energy is given by the functional
    \begin{align}
        E = \int e(\rho, \vc m, s, \vc F) \, \D \vc x
    \end{align}
    The evolution equations in the Eulerian frame are
    \begin{align}
        \partial_t \rho =& - \partial_i (\rho E_{m_i}) 
        \\
        \partial_t m_i =& - \partial_j(m_i E_{m_j}) - \rho \partial_i E_\rho - m_j \partial_i E_{m_j} - m_j \partial_i E_{m_j} 
        \\
        -& s \partial_i E_s - F^j_J \partial_i E_{F^j_J} + \partial_j(F^j_I E_{F^i_I} + F^i_O E_{F^i_I}) 
        \\
        \partial_t s =& - \partial_i (sE_{m_i})
        \\
        \partial_t F^i_I =& - E_{m_k} \partial_k F^i_I + F^j_I \partial_j E_{m_i} \:.
    \end{align}
    Total energy density $e$ can be prescribed as
    \begin{align}
        e = \frac{\vc m^2}{2 \rho} + \epsilon(\rho,s , \vc F) \:,
    \end{align}
    where $\epsilon$ is the elastic and internal energy. In particular, $E_{\vc m} = \frac{\vc m}{\rho} = \vc v$ becomes the velocity. The evolution equation for the deformation gradient then gets the explicit form
    \begin{align}
        \partial_t \vc F = -(\vc v \cdot \nabla) \vc F + \nabla \vc V \cdot \vc F \:,
    \end{align}
    which is the usual evolution equation for $\vc F$ in the Eulerian frame.
\end{example}

It was Riemann who noticed that the functions $f^{i \alpha}_j$ in \eqref{eq:h-system} are in fact tensors [CITACE]\cite{Dubrovin-Novikov}.

\begin{proposition}[Transformation of $f^{i \alpha}_j$] 
    \label{prop:transformace-A} 
    Under smooth change of variables $u^i \mapsto v^a$ of the form
    \begin{align}
        u^i = u^i(v^1,\cdots, v^N)
    \end{align}
    the functions $f^{i\alpha}_{j}$ transform for each $\alpha$ according to the tensor law
    \begin{align}
        f^{a \alpha}_{b}(v) = \pder{v^a}{u^i} \pder{u^j}{v^b} f^{i \alpha}_j (u) \:.
    \end{align}
\end{proposition}
\begin{proof}
    Using a direct calculation we obtain
    \begin{align}
        \pder{u^i}{t}(v) = \pder{u^i}{v^a} \pder{v^a}{t} \:, \\
        \pder{u^j}{x^\alpha}(v) = \pder{u^j}{v^b} \pder{v^b}{x^\alpha}\:,
    \end{align}
    so
    \begin{align}
        \pder{u^i}{v^a} \pder{v^a}{t} = \pder{u^j}{v^b} f^{i \alpha}_j (v(u)) \pder{v^b}{x^\alpha}
    \end{align}
    and therefore
    \begin{align}
        \pder{v^a}{t} = \underbrace{\pder{v^a}{u^i} \pder{u^j}{v^b} f^{i \alpha}_j(v(u))}_{f^{a \alpha}_b(v)} \pder{v^b}{x^\alpha} \:.
    \end{align}
\end{proof}

According to the previous lemma, if we denote the space of points $(t,x^\alpha) \subset \R \times \R^N$ as some manifold $M$, then the unknown variables $u^i(t,x^\alpha)$ can be seen as the local coordinates of that manifold. The functions $f^{i \alpha}_j$ are transformed as tensors of the type (1,1) in the $i$ and $j$ indices.

Our next purpose is to gain a richer geometry of that space $M$. If the functions $f^{i \alpha}_j$ have a special form, we can introduce a geometry of the Poisson brackets.

\begin{definition}
    \begin{enumerate}
        \item A Poisson bracket of the hydrodynamic type of two functionals $I_1$ a $I_2$ is defined as
        \begin{align}
            \set{I_1,I_2} = \int \D x 
            \left[ \frac{\delta I_1}{\delta u^q(x)} A^{qp} \frac{\delta I_2}{\delta u^p(x)} \right]
        \end{align}
        where
        \begin{align}
            A = (A^{qp}) = \left( g^{qp \alpha}(u) \der{}{x^\alpha} + b^{qp\alpha}_s(u) \pder{u^s}{x^\alpha} \right) \:.
        \end{align}
        where $g^{ij \alpha}$ and $b_k^{ij \alpha}$ are certain functions, $i,j,k = 1, \dots, N$ and $\alpha = 1, \dots, d $.

        In particular
        \begin{align}
            \set{u^i(x), u^j(y)} = g^{ij \alpha} [u(x)] \delta_\alpha(x-y) + b_k^{ij \alpha} [u(x)] u_\alpha^k(x) \delta(x-y) \:.
        \end{align}
        
        \item The functional of hydrodynamic type is a functional of the form
        \begin{align}
            H[u] = \int_{\R^d} h(u(x)) \D^d x \:,
        \end{align}
        where $h$ is independent of $u_\alpha$, $u_{\alpha \beta}$. The function $h$ is called a hamiltonian density.

        \item The hamiltonian system of hydrodynamic type is a system of the form
        \begin{align}
            u^i_t (x) = 
            \left[ g^{ij \alpha} [u(x)] \ppder{h(u)}{u^j}{u^k} + b_k^{ij \alpha} [u(x)] \pder{h(u)}{u^j} \right] u_\alpha^k(x) \:,
        \end{align}
        where $H[u]$ is the functional of the hydrodynamic type and $h$ the hamiltonian density.
    \end{enumerate}
\end{definition}

\begin{proposition}
    \begin{align}
        u^i_t(x) = \set{u^i,H} \:.
    \end{align}
\end{proposition}
\begin{proof}
    \begin{align}
        \set{u^i(x),H} = \int \D x' \D y' \fder{u^i(x)}{u^p(x')} \left[ g^{pq}(u(x')) \der{}{x'} + b^{pq}_m \pder{u^m}{x} \right] \fder{H}{u^q(y')} \:.
    \end{align}
    \begin{align}
        \fder{u^i(x)}{u^p(x')} = \delta^i_p \delta(x-x')
    \end{align}
    \begin{align}
        H[u] = \int h(u(y')) \D y' \:, \quad \fder{H}{u^q(y')} = \int \pder{h}{u^q}(y) \delta(y-y')
    \end{align}
    \begin{align}
        \set{u^i(x),H} =& \int \D y' \left[ g^{iq}(u(x)) \der{}{x} + b^{iq}_m(u(x)) \pder{u^m}{x} \right] \pder{h}{u^q}(y) \delta(y-y') 
        \\ =& g^{iq}(u(x)) \pder{^2 h}{u^k \partial u^q} \pder{u^k}{x} + b^{iq}_m(u(x)) \pder{u^m}{x} \pder{h}{u^q}
        \\ =& \left[ g^{ij}(u(x)) \pder{^2 h}{u^j \partial u^k}  + b^{ij}_k(u(x))  \pder{h}{u^j} \right] \pder{u^k}{x} \:.
    \end{align}
\end{proof}
\todo[inline]{Dokončit a přidělat $\alpha$. kde se předělá $\der{}{x}$ na $\der{}{y}$?}

Note that we have yet to show that the Poisson bracket of the hydrodynamic type defined above is indeed a Poisson bracket in the classical sense. We must verify that it satisfies the three properties: skew-symmetry, Leibniz rule and Jacobi identity. In fact, this will be the key theorem of this chapter.

\section{One-dimensional case}

In this section we first consider the one-dimensional case in which the unknown functions $u^i$ depend on only two variables $(t,x)$. The hamiltonian system is then
\begin{align}
    \pder{u^i}{t} (t,x) =&
    \left[ g^{ij} [u(t,x)] \ppder{h(u)}{u^j}{u^k} + b_k^{ij} [u(t,x)] \pder{h(u)}{u^j} \right] \pder{u^k}{x}(t,x) 
\end{align}
and the Poisson bracket of hydrodynamic type is of the form
\begin{align}
    \set{I_1,I_2} = \int \D x
    \left[ \frac{\delta I_1}{\delta u^q(x)} A^{qp} \frac{\delta I_2}{\delta u^p(x)} \right] \:,\quad \text{where } A^{qp} = \left( g^{qp}(u) \der{}{x} + b^{qp}_s(u) \pder{u^s}{x} \right) \:.
\end{align}
In particular
\begin{align}
    \label{eq:Poisson1D}
    \set{u^i(x), u^j(y)} =& g^{ij} [u(t,x)] \partial_x \delta(x-y) + b_k^{ij} [u(t,x)] \pder{u^k}{x} \delta(x-y) \:. 
\end{align}

We say that the Poisson bracket is non-degenerate if $\det(g^{ij}) \neq 0$. We will show later that the non-degeneracy is invariant under the transformation of the coordinates.

\begin{definition}
    Let $(g^{ij}(u))$ be a non-degenerate matrix. We define functions $\Gamma^{i}_{jk}(u)$ by
        \begin{align}
            b_k^{ij}(u) = -g^{is}(u) \Gamma^j_{sk}(u) \:, \quad i,j,k,s=1,\dots,N \:. \label{eq:definice-Gamma}
        \end{align}
\end{definition}

The choice of denotation $g^{ij}$ and $\Gamma^{i}_{jk}$ has its purpose. We will show soon that these are in fact the metric and afinne coefficients, respectively, on $M$.

\begin{proposition}[Leibniz rule for Poisson bracket]
    The Poisson bracket of the hydrodynamic type satisfies the Leibniz rule
    \begin{align}
        \label{eq:transformace-zavorka}
        \set{v^p(u^i(x)),v^q(u^j(y))} = \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \set{u^i(x),u^j(y)} \:. 
    \end{align}
\end{proposition}
\begin{proof}
    The coordinates are written as functionals in the form
    \begin{align}
        v^p(u^i(x)) = \int \D x' v^p(u^i(x')) \delta (x-x') \:.
    \end{align}
    Applying this to the definition of the Poisson bracket \eqref{eq:Poisson1D}, we have
    \begin{align}
        \set{v^p(u^i(x)),v^q(u^j(y))} 
        =& \int \D x' \int \D y' \underbrace{\fder{v^p}{u^i(x')} }_{\pder{v^p}{u^i}(x') \delta(x-x')} \set{u^i(x'),u^j(y')} \underbrace{\fder{v^q}{u^j(y')} }_{\pder{v^q}{u^j}(y') \delta(y-y')}
        = \\ =& \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \set{u^i(x),u^j(y)} \:.
    \end{align}
\end{proof}


\begin{proposition}[Transformation of $g$ and $\Gamma$] \label{prop:transoformace}
    Let $u^i \mapsto v^a$ be the smooth change of variables. Then
    \begin{enumerate}
        \item The $g^{ij}$ coefficients transform as the (2,0) tensors, i.e. 
        \begin{align}
            g^{pq}(v) = \pder{v^p}{u^i} \pder{v^q}{u^j} g^{ij}[u(v)] \:, \quad p, q = 1, \dots, N \:. \label{eq:transformace-metrika}
        \end{align}
        \item The $\Gamma^i_{jk}$ coefficients  transform like Christoffel symbols, i.e.
        \begin{align}
            \Gamma^p_{qr} (v) = \pder{v^p}{u^i} \pder{u^j}{v^q} \pder{u^k}{v^r} \Gamma^i_{jk}(u) + \pder{v^p}{u^i} \ppder{u^i}{v^q}{v^r} \:. \label{eq:transformace-konexe}
        \end{align}
    \end{enumerate}
\end{proposition}

\begin{proof}
    \begin{enumerate}
        \item Let us apply the transformation equation \eqref{eq:transformace-zavorka} to the definition of the Poisson bracket \eqref{eq:Poisson1D}. We get 
        \begin{align}
            g^{pq}[v(u(x))] \partial_x \delta(x-y) + b^{pq}_s[v(u(x))] \pder{v^s}{u^k}(x) \pder{u^k}{x} \delta(x-y) \nonumber
            \\ = \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \left[ g^{ij}[u(x)] \partial_x \delta(x-y) + b^{ij}_k[u(x)] \pder{u^k}{x} \delta(x-y) \right] \:. \label{eq:dosad}
        \end{align}
        From now on (for readibility) we denote 
        \begin{align}
            T^a_k(x) := \pder{v^a}{u^k}(x) \:.
        \end{align}
        We apply Dirac identity (Lemma \vref{lemma:delta}) to $T^q_j(y) \partial_x \delta(x-y)$ on the right-hand side of \eqref{eq:dosad}. Hence all functions are then of variable $x$, from now on we shall not write it explicitely. We have
        \begin{align}
            g^{pq}(v) \partial_x \delta(x-y) + b^{pq}_n(v) T^n_j \pder{u^j}{x} \delta(x-y) \nonumber
            \\ = T^p_i T^q_j g^{ij}(u) \partial_x \delta(x-y) 
            + \left( \ppder{v^q}{u^j}{u^k} + T^p_i T^q_j b^{ij}_k \right) \pder{u^k}{x} \delta(x-y) \:. \label{eq:porovnani}
        \end{align}
        The terms with $\partial_x \delta$ must be equal to each other, as must $\delta$ terms. From $\partial_x \delta$ terms we get
        \begin{align}
            g^{pq}(v) = T^p_i T^q_j g^{ij}(u) \:,
        \end{align}
        which is the transformation relation for $g$.

        \item From $\delta$ terms in \eqref{eq:porovnani}, we get
        \begin{align}
            b^{pq}_n(v) T^n_k =
            b^{ij}_k(u) T^p_i T^q_j + g^{ij}(u) T^p_i \ppder{v^q}{u^i}{u^k}
        \end{align}
        and after \eqref{eq:definice-Gamma}
        \begin{align}
            - g^{ps}(v) \Gamma^{q}_{sn}(v) T^n_k =
            - g^{il}(u) \Gamma^j_{lk}(u) T^p_i T^q_j + g^{ij}(u) T^p_i \ppder{v^q}{u^i}{u^k} \:.
        \end{align}
        On the left-hand side we use the transformation of $g$ \eqref{eq:transformace-metrika}
        \begin{align}
            -g^{ij}(u) \Gamma^q_{sm}(v) T^p_i T^s_j T^m_k = - g^{ij}(u) \Gamma^l_{jk} T^p_i T^q_l + g^{ij}(u) \ppder{v^q}{u^i}{u^k} T^p_i 
        \end{align}
        and after vectoring out $g^{ij}(u) T^p_i$
        \begin{align}
            \Gamma^l_{jk}(u) T^q_l = \Gamma^q_{sm}(v) T^s_j T^m_k + \ppder{v^q}{u^i}{u^k} \:.
        \end{align}
        All that remains is to multiply this equation with $(T^{-1})^a_q$ and we get the final transformation relation for $\Gamma$
        \begin{align}
            \Gamma^a_{jk}(u) = \Gamma^q_{sm}(v) \pder{v^s}{u^j} \pder{v^m}{u^k} \pder{u^a}{v^q} + \ppder{v^q}{u^i}{u^k} \pder{u^a}{v^q} \:.
        \end{align}
    \end{enumerate}
\end{proof}

Let us summarize the results. We have defined Poisson bracket in the way that it satisfies the Leibniz rule. It remains to investigate the skew-symmetry and Jacobi identity. We have also defined $g^{pq}$ and $\Gamma^p_{qr}$, which transform like tensors and Christoffel symbols, respectively. It remains to show that $g^{pq}$ is indeed symmetric and $\Gamma$ is the Levi-Civita connection, i.e. the corresponding covariant derivative annuls the metric. We are now ready to prove the key theorem of this chapter which shows that these properties are indeed equivalent. Moreover, the corresponding covariant derivative has zero curvature, which indicates that the phase space $M$ is in fact Euclidean space.

\begin{theorem}[Dubrovin, Novikov] \label{theorem1:ekvivalence}
    Let $\det(g^{ij}) \neq 0$. Then \eqref{eq:Poisson1D} defines a Poisson bracket with skew-symmetry, Leibniz rule and Jacobi identity if and only if these three conditions are satisfied:
    \begin{enumerate}
        \item $g^{ij} = g^{ji}$, that is, $g^{ij}$ is a metric on the phase space $M$.
        \item $\Gamma^{i}_{jk} = \Gamma^i_{kj}$, that is, $\Gamma^{i}_{jk}$ are affine coefficients, such that the corresponding covariant derivative has zero torsion and anihilate the metric $g^{ij}$.
        \item The covariant derivative corresponding to $\Gamma^{i}_{jk}$ has zero curvature.
    \end{enumerate}
\end{theorem}

\begin{corollary}
    There are local coordinates $w^i = w^i(u^1, \dots, u^N)$, $i = 1, \dots, N$ such that
    \begin{align}
        g^{ij}(w) = \tilde g^{ij} = \const \:, \quad \Gamma^i_{jk} (w) = 0 \:.
    \end{align}
    In these coordinates is Poisson bracket reduced to the constant one
    \begin{align}
        \set{w^i(x),w^j(y)} = \tilde{g}^{ij} \partial_x \delta(x-y) \:.
    \end{align}
    The only local invariant of the Poisson bracket is the signature of the metric $g^{ij}(u)$.
\end{corollary}

\begin{proof}[Proof of theorem \ref{theorem1:ekvivalence}]
    The proof is divided into three steps.
    \\
    \textbf{Step 1: Skew-symmetry of Poisson bracket implies the symmetry of $g^{ij}$ and compatibility with $\Gamma^i_{jk}$.}

    Let the Poisson bracket be skew-symmetric, i.e.
    \begin{align}
        \set{u^i(x),u^j(y)} + \set{u^j(y),u^i(x)} = 0 \:.
    \end{align}
    The second bracket reads as
    \begin{align}
        \set{u^j(y),u^i(x)} =  g^{ji}[u(y)] \partial_x \delta(y-x) + b^{ji}_k[u(y)] \pder{u^k}{y} \delta(y-x) \:.
    \end{align}
    Let us apply Dirac identites (Lemma \vref{lemma:delta}) on $g^{ji}[u(y)]\partial_x \delta(y-x)$. We get
    \begin{align}
        \set{u^j(y),u^i(x)} =& \nonumber \\ 
        = - g^{ji} [u(x)] \partial_x \delta(x-y) -& \pder{g^{ji}}{u^k}[u(x)] \pder{u^k}{x} \delta(x-y) + b^{ji}_k[u(x)] \pder{u^k}{x} \delta(x-y)
        \:.
    \end{align}
    The skew-symmetry is then
    \begin{align}
        0 = \set{u^i(x),u^j(y)} + \set{u^j(y),u^i(x)} = \nonumber
        \\= \left[ g^{ij}[u(x)]  - g^{ji}[u(x)] \right] \partial_x \delta(x-y) + \left[ b^{ij}_k - \pder{g^{ji}}{u^k}  + b^{ji}_k  \right] \pder{u^k}{x} \delta(x-y) \:.
    \end{align}
    The right-hand side is equal to zero if and only if
    \begin{align}
        g^{ij}(u) = g^{ji}(u) \:, \label{eq:Th.Novikov-symetrie} \\
        \pder{g^{ij}}{u^k}(u) = b^{ij}_k(u) + b^{ji}_k(u)  \:. \label{eq:Th.Novikov-konexe}
    \end{align}
    Equation \eqref{eq:Th.Novikov-symetrie} says that $g^{ij}$ is a symmetric tensor. By assumption $\det g^{ij}$ is non-degenerate, so it defines a metric structure on $M$. Equation \eqref{eq:Th.Novikov-konexe} is equivalent to
    \begin{align}
        \pder{g^{ij}}{u^k} + g^{is} \Gamma_{sk}^j + g^{sj} \Gamma_{sk}^i = 0 \:.
    \end{align}
    If $\nabla$ is the covariant derivative corresponding to $\Gamma^i_{jk}$, then $\nabla_k g^{ij} = 0$. So $\Gamma_{ij}^k$ are affine connection coefficients and are compatible with $g^{ij}$.

    \textbf{Step 2: Jacobi identity implies zero torsion and curvature.} 
    
    Let us assume that Jacobi identity holds. We denote
    \begin{align}
        \mathcal J^{ijk}(x,y,z) = J^{ijk}(x,y,z)+ J^{jki}(y,z,x)+ J^{kij}(z,x,y) = 0
    \end{align}
    where
    \begin{align}
        J^{ijk}(x,y,z) = \set{\set{u^i(x),u^j(y)}, u^k(z)} \:.
    \end{align}

    From now on we shall use the abbreviated notation
    \begin{align}
        g^{ij}_{,m} = \pder{g^{ij}}{u^m} \:, \quad b^{ij}_{k,m} = \pder{b^{ij}_k}{u^m} \:, \quad u^k_x = \pder{u^k}{x}  \:.
    \end{align}
    One of the Jacobiators reads as
    \begin{align*}
        J^{ijk}(x,y,z) =
        \int \D \xi \fder{\set{u^i(x),u^j(y)}}{u^m(\xi)} 
        \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \fder{u^k(z)}{u^n(\xi)}  \:.
    \end{align*}
    The functional derivatives are
    \begin{align}
        \fder{u^k(z)}{u^n(\xi)} = \delta^k_n \delta(z-\xi)
    \end{align}
    and 
    \begin{align}
        \fder{\set{u^i(x),u^j(y)}}{u^m(\xi)} = \fder{}{u^m(\xi)} \left[ g^{ij}(x) \partial_x \delta(x-y) + b^{ij}_k(x) \partial_x u^k \delta(x-y)\right] = 
        \nonumber
        \\ = \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \right] \delta (x-\xi) - b^{ij}_m(x) \delta(x-y) \partial_\xi \delta(x-\xi) \:.
    \end{align}
    We have
    \begin{align}
        J^{ijk}(x,y,z) = J_1^{ijk}(x,y,z) + J_2^{ijk}(x,y,z) 
    \end{align}
    where
    \begin{align*}
        & J_1^{ijk}(x,y,z) = \int \D \xi  \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) \delta(x-\xi) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \delta(x-\xi) \right]   \\ 
        & \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \delta^k_n \delta(z-\xi)  
    \end{align*}
    and 
    \begin{align*}
        J_2^{ijk}(x,y,z) = - \int \D \xi b^{ij}_m(x) \delta(x-y) \partial_\xi \delta(x-\xi) \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \delta^k_n \delta(z-\xi)  \:.
    \end{align*}
    In $J_1$ we use integration with $\delta(x-\xi)$ and get rid of the integral:
    \begin{align*}
        J_1^{ijk}(x,y,z) =& \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \right] 
        \left[ g^{mk}(\xi) \partial_x + b^{mk}_p \partial_x u^p \cdot \right] \delta(z-x)
        \\
        =& \left[ g^{ij}_{,m} g^{mk} \partial_x \delta(x-y) + b^{ij}_{k,m} g^{mk} u^k_x \delta(x-y) \right] \partial_x \delta(z-x) + 
        \\
        +& \left[ g^{ij}_{,m} b^{mk}_p u^p_x \partial_x \delta(x-y) + b^{ij}_{k,m} b^{mk}_p u_x^p  u_x^k \delta(x-y) \right] \delta(z-x) \:.
    \end{align*}

    In $J_2$ we first apply integration by parts to get rid of $\partial_\xi \delta(x-\xi)$ and then integrate:
    \begin{align*}
        J_2^{ijk}(x,y,z) = \int \D \xi b^{ij}_m(x) \delta(x-y) \delta(x-\xi) \partial_\xi \left[ g^{mk}(\xi) \partial_\xi \delta(z-\xi) + b^{mk}_p \partial_\xi u^p \delta(z-\xi) \right]
        \\ = b^{ij}_m(x) \delta(x-y) \partial_x \left[ g^{mn}(x) \partial_x \delta(z-x) + b^{mn}_p \partial_x u^p \delta(z-x) \right]
        \\ = b^{ij}_m(x) \delta(x-y) \big[ g^{mk}_{,s} u^s_x \partial_x \delta (z-x) + g^{mk} \partial_x \partial_x \delta (z-x) 
        \\ + b^{mk}_{p,s}(x) u^s_x u^p_x \delta (z-x) + b^{mn}_{p}(x) u^p_{xx} \delta (z-x) + b^{mk}_{p}(x) u^p_x \partial_x \delta (z-x) \big]
    \end{align*}

    \begin{align*}
        J_2^{ijk}(x,y,z) =& b^{ij}_m g^{mk}_{,s} u^s_x \delta (x-y) \partial_x \delta (z-x) 
        + b^{ij}_m g^{mk} \delta(x-y) \partial_x \partial_x \delta (z-x) 
        \\ +& b^{ij}_m b^{mk}_{p,s} u^s_x u^p_x \delta (x-y) \delta (z-x)
        + b^{ij}_m b^{mn}_p u^p_{xx} \delta (x-y) \delta(z-x) 
        \\ +& b^{ij}_m b^{mk}_p u^p_x \delta(x-y) \partial_x \delta(z-x) \:.
    \end{align*}

    In total we end with terms
    \begin{align}
        J^{ijk}(x,y,z) =& 
        E^{ijk}(x) \delta(x-y) \delta(z-x) 
        \\+& F^{ijk}(x) \delta(x-y) \partial_x \delta(z-x) 
        \\+& G^{ijk}(x) \partial_x \delta(x-y) \delta (z-x) 
        \\+& H^{ijk}(x) \partial_x \delta(x-y) \partial_x \delta (z-x) 
        \\+& I^{ijk}(x) \delta(x-y) \partial_x \partial_x \delta (z-x)
    \end{align}
    where
    \begin{align}
        E^{ijk} =& (b^{ij}_m b^{mk}_{p,s} + b^{ij}_{s,m} b^{mk} ) u^p_x u^s_x + b^{ij}_m b^{mk}_p u^p_{xx} \\
        F^{ijk} =& (b^{ij}_{s,m} g^{mk} + g^{mk}_{,s} b^{ij}_m + b^{ij}_m b^{mk}_s)u_x^s \\
        G^{ijk} =& g^{ij}_{,m} b^{mk}_s u^s_x \\
        H^{ijk} =& g^{ij}_{,m} g^{mk} \\
        I^{ijk} =& b^{ij}_m g^{mk} \:.
    \end{align}
    Now the procedure is the following: firstly we have to add the cyclic permutations $J^{jki}(y,z,x)$ and $J^{kij}(z,x,y)$ to obtain $\mathcal J^{ijk}(x,y,z)$. Secondly, the resulting generalized function $\mathcal J^{ijk}(x,y,z)$ is equal to zero, i.e.
    \begin{align}
        \dual{\mathcal J^{ijk}(x,y,z)}{p_i(x)q_j(y)r_k(z)} = 0
    \end{align}
    or in the integral notation 
    \begin{align}
        \iiint \D x \D y \D z J^{ijk}(x,y,z) p_i(x)q_j(y)r_k(z) = 0 \:.
    \end{align}
    We want to reduce this integral into a one-dimensional integral
    \begin{align}
        \int \D x \sum_{a,b = 0}^2 A^{ijk}_{ab} p_i(x) q^{(a)}_j(x) r^{(b)}_k (x) \:,
    \end{align}
    where $f^{(a)}$ means the $a$-th derivative. This integral is equal to zero if and only if
    \begin{align}
        A^{ijk}_{ab} = 0 \quad \forall a,b = 0,1,2 \:.
    \end{align}
    From this condition we shall obtain the zero torsion and curvature.
    We illustrate the procedure of reduction to the one-dimensional integral on one particular expression. For instance, we have
    \begin{align*}
        \int \big[ F^{ijk}(x) \delta(x-y) \partial_x \delta(z-x) 
        +& F^{jki}(y) \delta(y-z) \partial_y \delta(x-y) 
        + F^{kij}(z) \delta(z-x) \partial_z \delta(y-z) \big] \times \\ 
        \times&  p_i(x) q_j(y) r_k(z) \D x \D y \D z \:.
    \end{align*}
    We use the antisymmetry of $\delta$-derivatives
    \begin{align*}
        \partial_x \delta(z-x) = - \partial_z \delta (z-x) \:, \:
        \partial_y \delta(x-y) = - \partial_x \delta(x-y) \:, \: 
        \partial_z \delta(y-z) = - \partial_y \delta (y-z) \:,
    \end{align*}
    and obtain
    \begin{align*}
        \int \D x F^{ijk}(x) p_i q_j r'_k + \int \D x F^{jki}(x)  p'_i q_j r_k +
        \int \D x F^{kij}(x) p_i q'_j r_k \:.
    \end{align*}
    In the term containing $p'_i$ we perform integration by parts. The result is
    \begin{align*}
        \int \D x (F^{ijk}-F^{jki}) p_i q_j  r'_k +
        \int \D x (F^{kij}-F^{jki}) p_i q'_j r_k -
        \int \D x \partial_x F^{jki} p_i q_j r_k \:.
    \end{align*}
    In this particular case, we end up with terms, witch contribute to $A^{ijk}_{01}$, $A^{ijk}_{10}$ and $A^{ijk}_{00}$, respectively. Other terms in $\mathcal J^{ijk}(x,y,z)$ are handled in the similar way.

    We are insterested only in functions $A^{ijk}_{00}$ and $A^{ijk}_{02}$. We shall also use the compatibility condition \eqref{eq:Th.Novikov-konexe}, which is
    \begin{align}
        g^{ij}_{,m} = b^{ij}_m + b^{ji}_m \:.
    \end{align}

    The $A^{ijk}_{02}$ function reads as
    \begin{align*}
        A_{02}^{ijk} =& I^{ijk} + I^{jki} - H^{jki}
        \\ =& b^{ij}_m g^{mk} + b^{jk}_m g^{mi} - g^{jk}_{,m} g^{mi} 
        \\ =& b^{ij}_m g^{mk} + b^{jk}_m g^{mi} - b^{jk}_m g^{mi} - b^{kj}_m g^{mi}
        \\ =& b^{ij}_m g^{mk} - b^{kj}_m g^{mi} 
        \\ =& -g^{ip} \Gamma^{j}_{pm} g^{mk} + g^{ks} \Gamma^{j}_{sm} g^{mi} \:,
    \end{align*}
    therefore, after multiplying with $g_{ai}g_{bk}$
    \begin{align}
        \Gamma^j_{ab} - \Gamma^j_{ba} = 0 \:.
    \end{align}
    So the covariant derivative corresponding to $\Gamma^{j}_{ab}$ has zero torsion.

    The $A^{ijk}_{00}$ function reads as
    \begin{align}
        A_{00}^{ijk} = E^{ijk} + E^{jki} + E^{kij} - \partial_x F^{jki} - \partial_x G^{kij}
    \end{align}
    which can be modified into
    \begin{align}
        A_{00}^{ijk} = B^{ijk}_p(u) u^p_{xx} + C^{ijk}_{ps}(u) u^p_x u^s_x = 0 \:,
    \end{align}
    where
    \begin{align}
        B^{ijk}_p 
        = (b^{jk}_{s,p} - b^{jk}_{p,s}) g^{si} + b_s^{ij} b_p^{sk} - b_s^{ik} b_p^{sj} \:.
    \end{align}
    The function $B^{ijk}_p$ beeing zero implies the zero curvature, which follows from
    \begin{align*}
        B^{ijk}_p  
        =& -g^{is} \left( g^{jm}_{,p} \Gamma^k_{ms} + g^{jm} \Gamma^k_{ms,p} - g^{jm}_{,s} \Gamma^k_{mp} - g^{jm} \Gamma^k_{mp,s} \right) 
        \\ +& g^{im} \Gamma^j_{ms} g^{sn} \Gamma^{k}_{np} - g^{im} \Gamma^k_{ms} g^{sn} \Gamma^j_{np}
        = \\ =& g^{is} g^{jn} \left( \Gamma^m_{np} \Gamma^k_{ms} - \Gamma^{m}_{ns} \Gamma^k_{mp} + \Gamma^{k}_{mp,s} -  \Gamma^{k}_{ms,p} \right) 
        \\ +& g^{is} g^{nm} \left( \Gamma^j_{np} \Gamma^{k}_{ms} - \Gamma^j_{ns} \Gamma^k_{mp} \right) + g^{im} g^{sn} \left( \Gamma^j_{ms} \Gamma^k_{np} - \Gamma^k_{ms} \Gamma^j_{np} \right)
        = \\ =& -g^{is} g^{jn} \left( \Gamma^{m}_{ns} \Gamma^k_{mp}  - \Gamma^m_{np} \Gamma^k_{ms} + \Gamma^{k}_{ms,p} - \Gamma^{k}_{mp,s} \right)
        = \\ =& -g^{is} g^{jn} R^k_{nps} \:.
    \end{align*}
    So far we proved that if hydrodynamical Poisson bracket satisfies skew-symmetry and Jacobi identity, the conditions 1-3 are satisfied.

    \textbf{Step 3: Zero curvature and torsion imply properties of the Poisson bracket.}

    If $\nabla$ has zero torsion and curvature, there are coordinates $w^i=w^i(u^1,\dots,u^N)$ for $i=1,\dots,N$ such that $g^{ij} = \const$ a $b^{ij}_k = 0$. In these coordinates
    \begin{align}
        \set{w^i(x),w^j(y)} = \tilde{g}^{ij} \partial_x \delta(x-y) \:.
    \end{align}
    Jacobi identity, skew-symmetry and Leibniz rule are for that bracket satisfied trivially. Therefore the three conditions are also sufficient. That finishes the proof.
\end{proof}

It follows from the theorem \vref{theorem1:ekvivalence} that we can write the original functions $f^{i}_j$ in \eqref{eq:h-system} by the Laplace-Beltrami operator.

\begin{proposition}[Hamiltonian system by the Laplace operator]
    Given Hamiltonian system of hydrodynamic type
    \begin{align}
        \pder{u^i}{t} = f^i_k(u) \pder{u^k}{x} \:, \quad f^i_k(u) = g^{ij}(u) \ppder{h}{u^j}{u^k} - g^{is}(u) \Gamma^j_{sk}(u) \pder{h}{u^j} \:, \label{eq:hamiltonovsky-system}
    \end{align}
    one can write
    \begin{align}
        f^i_k(u) = \nabla^i \nabla_k h(u) \:, 
    \end{align}
    where $\nabla_j$ is Levi-Civita covariant derivative compatible with $g_{ij}$ and $\nabla^i = g^{is} \nabla_s$. 
\end{proposition}
\begin{proof}
    Since $h$ is ordinary function, application of $\nabla_k$ is just the partial derivative w.r.t. $u^k$:
    \begin{align}
        \nabla_k h(u) =& \pder{h}{u^k} \:.
    \end{align}
    Now this term $\pder{h}{u^k}$ is a covector, so $\nabla_i$ is given by the partial derivative and the $\Gamma_{ij}^k$ part by
    \begin{align}
        \nabla^i \nabla_k h(u) =& g^{is} \nabla_s \pder{h}{u^k} = g^{is} \left( \ppder{h}{u^s}{u^k} - \Gamma^j_{sk} \pder{h}{u^j} \right) = f^i_k(u) \:.
    \end{align}
\end{proof}

Another direct application of the theorem \vref{theorem1:ekvivalence} is the sufficient condition for the determinating, whether is a given system Hamiltonian or not.

\begin{theorem}[The sufficient condition the a system to be Hamiltonian]
    
    A system of hydrodynamic type 
    \begin{align}
        u^i_t = f^i_j(u) u^j_x \:,
    \end{align}
    is Hamiltonian if and only if there is a non-degenerate metric $g^{ij}(u)$ and corresponding covariant derivative $\nabla_j$, such that
    \todo[inline]{V tomto vztahu nesedí indexy.}
    \begin{align}
        g^{ij} f^k_j = g_{jk} f^k_i \:, \label{eq:gf=gf} \\
        \nabla_i f^k_j = \nabla_j f^k_i \label{eq:nablaf} \:.
    \end{align}
    In particular, \eqref{eq:nablaf} is equivalent to the zero torsion of $\nabla_i$.
\end{theorem}

\begin{proof}
    If the system is Hamiltonian, then $f^k_j = \nabla^k \nabla_j h$ and $\nabla_j$ has zero torsion, that means
    \begin{align}
        \nabla_i f^k_j = g^{km} \nabla_i \nabla_m \nabla_j h = g^{km} \nabla_j \nabla_m \nabla_i h = \nabla_j f^{k}_i \:,
    \end{align}
    and
    \begin{align}
        g^{ij} f^{k}_j = g^{ij} g^{mk} \nabla_m \nabla_j h = \nabla^i \nabla^k h = \nabla^k \nabla_i h
    \end{align}
\end{proof}


\section{Multi-dimensional case}

In the multi-dimensional case, we have a set of metrics $g^{ij \alpha}$ and connections $b^{ij \alpha}_k$ (identified with $\nabla^{(\alpha)}_j$ and $\Gamma^{i (\alpha)}_{jk}$), where $\alpha = 1 , \cdots, d$. The first observation is, that they represent coordinates of a vector under a orthogonal transformation of the space coordinates $x^\alpha$.
\todo[inline]{Skutečně se mění jenom závislost $u$ na $x^\alpha$, nebo i něco jiného? Může to platit i při nějaké obecné transformaci?}
\begin{proposition}[Orthogonal transformation the space coordinates]
    For any changes of the spatial variables $\tilde x^\alpha \coloneqq c^\alpha_\beta x^\beta$, where $\alpha = 1, \cdots, d$ and $\det (c^\alpha_\beta) = 1$, the metrics $g^{ij \alpha}$ and $b^{ij \alpha}_k$ transforms as components of a vector.
\end{proposition}

\begin{proof}
    The only variable that changes is $\pder{u^i}{x^\alpha}$
    \begin{align}
        \pder{u^i}{x^\beta} = \pder{u^i}{\tilde x^\alpha} \pder{\tilde x^\alpha}{x^\beta} = \pder{u^i}{\tilde x^\alpha} c^\alpha_\beta \:.
    \end{align}
    So
    \begin{align}
        g^{ij \alpha}[u(\tilde x)] = c^\alpha_\beta g^{ij \beta}[u(x)] \:, \quad b^{ij \alpha}_k [u(\tilde x)] = c^\alpha_\beta b^{ij \beta}_k [u(x)] \:.
    \end{align}
\end{proof}

\begin{definition}[Strongly non-degenerate metrics]
    We say that the vector of metrics $g^{ij \alpha}$ is strongly non-degenerate, if there are some constants $c_\alpha \in \R$ such that $c_\alpha g^{ij \alpha}$ is non-degenerate metric.
\end{definition}
(Of course, linear combination of symmetric tensors is symmetric, so the only condition for strong non-degeneracy is to have $\det (c_\alpha g^{ij \alpha}) \neq 0$.)

\begin{theorem}
    Let the Hamiltonian system be strongly non-degenerate. Then
    \begin{enumerate}
        \item for $N=1$ the system can be reduced to constant form
        \begin{align}
            g^{ij}(u) = \tilde g^{ij}(u) \:,
        \end{align}

        \item for $N \geq 2$ can be reduced to linear form
        \begin{align}
            g^{ij \alpha}(u) = g^{ij \alpha}_k u^k + \tilde g^{ij \alpha} \:, \quad \alpha = 1, \cdots , d \:, \\
        \end{align}
        where the coefficients $g^{ij \alpha}_{,k} = b^{ij \alpha}_k + b^{ij \alpha}_k$, $\tilde g^{ij \alpha}$ and $b^{ij \alpha}_k$ are constant.
    \end{enumerate}
\end{theorem}
