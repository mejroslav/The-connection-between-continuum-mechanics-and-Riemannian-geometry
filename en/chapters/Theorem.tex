\chapter{Systems of hydrodynamic type: one-dimensional case}

In this chapter we shall prove the theorem of the connection between the hydrodynamic Poisson bracket and the metrics found in the homogeneous system of hydrodynamic type. The original result was given in 1983 by B.A.Dubrovin and S.P.Novikov and can be found in \cite{Dubrovin-Novikov}. Since then, many authors have contributed to the further development of this theory, e.g. Grinberg in \cite{Grinberg}, Ferapontov in \cite{Ferapontov} and Mochov in \cite{Mochov}.
The proof itself and the preceding lemmas are based on a considerable amount of technical computations, which we shall clarify in detail in order to offer the reader a comprehensive understanding of the chapter in question.


\section{Systems of hydrodynamic type}

\begin{definition}[Homogeneous system of hydrodynamic type]
    A homogeneous system of hydrodynamic type is an equation of the form
    \begin{align}
        \label{eq:h-system}
        \pder{u^i}{t} = f_j^{i \alpha} (u) \pder{u^j}{x^\alpha} \:,
    \end{align}
    where $u^i(t,x^\alpha)$ are unknown functions, $i = 1, \dots , N$, $\alpha = 1, \dots , d$.
\end{definition}

Sometimes we refer to the number of equations $N$ as the dimension of the hydrodynamical phase space and to the number of spatial variables $d$ as the dimension of the configuration space.

\todo[inline]{Příklad asi přesunout do jiné kapitoly.}
Before we go any further, let us present a few examples.

\begin{example}
    The energy is given by the functional
    \begin{align}
        E = \int e(\rho, \vc m, s, \vc F) \, \D \vc x \:.
    \end{align}
    The evolution equations in the Eulerian frame are
    \begin{align}
        \partial_t \rho =& - \partial_i (\rho E_{m_i}) \:,
        \\
        \partial_t m_i =& - \partial_j(m_i E_{m_j}) - \rho \partial_i E_\rho - m_j \partial_i E_{m_j} - m_j \partial_i E_{m_j} \:,
        \\
        -& s \partial_i E_s - F^j_J \partial_i E_{F^j_J} + \partial_j(F^j_I E_{F^i_I} + F^i_O E_{F^i_I}) \:,
        \\
        \partial_t s =& - \partial_i (sE_{m_i}) \:,
        \\
        \partial_t F^i_I =& - E_{m_k} \partial_k F^i_I + F^j_I \partial_j E_{m_i} \:.
    \end{align}
    Total energy density $e$ can be prescribed as
    \begin{align}
        e = \frac{\vc m^2}{2 \rho} + \epsilon(\rho,s , \vc F) \:,
    \end{align}
    where $\epsilon$ is the elastic and internal energy. In particular, $E_{\vc m} = \frac{\vc m}{\rho} = \vc v$ becomes the velocity. The evolution equation for the deformation gradient then gets the explicit form
    \begin{align}
        \partial_t \vc F = -(\vc v \cdot \nabla) \vc F + \nabla \vc V \cdot \vc F \:,
    \end{align}
    which is the usual evolution equation for $\vc F$ in the Eulerian frame.
\end{example}

It was Riemann who noticed that the functions $f^{i \alpha}_j$ in \eqref{eq:h-system} are in fact tensors \cite{Dubrovin-Novikov}.

\begin{proposition}[Transformation of $f^{i \alpha}_j$] 
    \label{prop:transformace-A} 
    Under smooth change of variables $u^i \mapsto v^a$ of the form
    \begin{align}
        u^i = u^i(v^1,\cdots, v^N) \:,
    \end{align}
    the functions $f^{i\alpha}_{j}$ transform for each $\alpha$ according to the tensor law
    \begin{align}
        f^{a \alpha}_{b}(v) = \pder{v^a}{u^i} \pder{u^j}{v^b} f^{i \alpha}_j (u) \:.
    \end{align}
\end{proposition}
\begin{proof}
    Using a direct calculation, we obtain
    \begin{align}
        \pder{u^i}{t}(v) = \pder{u^i}{v^a} \pder{v^a}{t} \:, \\
        \pder{u^j}{x^\alpha}(v) = \pder{u^j}{v^b} \pder{v^b}{x^\alpha}\:.
    \end{align}
    Hence
    \begin{align}
        \pder{u^i}{v^a} \pder{v^a}{t} = \pder{u^j}{v^b} f^{i \alpha}_j (v(u)) \pder{v^b}{x^\alpha} \:,
    \end{align}
    therefore
    \begin{align}
        \pder{v^a}{t} = \underbrace{\pder{v^a}{u^i} \pder{u^j}{v^b} f^{i \alpha}_j(v(u))}_{f^{a \alpha}_b(v)} \pder{v^b}{x^\alpha} \:.
    \end{align}
\end{proof}

According to the previous lemma, if we denote the space of points $(t,x^\alpha) \subset \R \times \R^N$ as some manifold $M$, then the unknown variables $u^i(t,x^\alpha)$ can be seen as the local coordinates of that manifold. The functions $f^{i \alpha}_j$ are transformed as tensors of the type $(1,1)$ in the $i$ and $j$ indices.

Our next purpose is to gain a richer geometry of that space $M$. If the functions $f^{i \alpha}_j$ have a special form, we can introduce a geometry of the Poisson brackets.

\begin{definition}
    \begin{enumerate}
        \item The Dubrovin-Novikov bracket of two functionals $I_1$ a $I_2$ is defined as
        \begin{align}
            \set{I_1,I_2} = \sum_{\alpha = 1}^ d \int \D x 
            \left[ \frac{\delta I_1}{\delta u^p(x)} \left( g^{pq \alpha}(u) \der{}{x^\alpha} + b^{pq\alpha}_s(u) \pder{u^s}{x^\alpha} \right) \frac{\delta I_2}{\delta u^q(x)} \right] \:, \label{eq:Dubrovin-Novikov bracket}
        \end{align}
        where $g^{ij \alpha}$ and $b_k^{ij \alpha}$ are certain functions, $i,j,k = 1, \dots, N$ and $\der{}{x^\alpha}$ is the total derivative with respect to the independent variable $x^\alpha$,
        \begin{align}
            \der{}{x^\alpha} =& \pder{}{x^\alpha} + u^i_\alpha \pder{}{u^i} + u^i_{\alpha \beta} \pder{}{u^i_\beta} + \cdots + u^i_{\beta_1 \cdots \beta_s \alpha} \pder{}{u^i_{\beta_1 \cdots \beta_s}} + \cdots \:, \\
            u^i_{\beta_1 \cdots \beta_s} =& \pder{^s u^i}{x^{\beta_1} \cdots \partial x^{\beta_s}} \:.
        \end{align}
        The summation over repeating upper and lower indices is assumed, moreover, in this case the summation over $\beta_1, \cdots, \beta_s$ is taken over distinct (up to arbitrary permutation) sets of these indices. (One can consider that these sets of indices are ordered: $\beta_1 \leq \cdots \leq \beta_s$.)
        
        \item The functional of hydrodynamic type is a functional of the form
        \begin{align}
            H[u] = \int_{\R^d} h(u(x)) \D^d x \:,
        \end{align}
        where $h$ is independent of $u_\alpha$, $u_{\alpha \beta}$. The function $h$ is called a hamiltonian density.

        \item The hamiltonian system of hydrodynamic type is a system of the form
        \begin{align}
            u^i_t (x) = 
            \left[ g^{ij \alpha} [u(x)] \ppder{h(u)}{u^j}{u^k} + b_k^{ij \alpha} [u(x)] \pder{h(u)}{u^j} \right] u_\alpha^k(x) \:,
        \end{align}
        where $H[u]$ is the functional of the hydrodynamic type and $h$ the hamiltonian density.
    \end{enumerate}
\end{definition}

%\begin{remark}
%    In the literature, other names for the Dubrovin-Novikov bracket are used. The authors themselves in \cite{Dubrovin-Novikov} refer to the Poisson bracket of the hydrodynamic type, other authors refer to the 1st degree homogeneous 
%\end{remark}


\todo[inline]{...Jednoduché cvičení a zároveň důležité...}

\begin{proposition}[Dubrovin-Novikov bracket of field variables]
    \begin{align}
        \set{u^i(x), u^j(y)} = g^{ij \alpha} [u(x)] \delta_\alpha(x-y) + b_k^{ij \alpha} [u(x)] u_\alpha^k(x) \delta(x-y) \:.
    \end{align}
\end{proposition}

\begin{proof}
    \begin{align}
        \set{u^i(x), u^j(y)} = \int \D \xi \fder{u^i(x)}{u^p(\xi)} \left( g^{pq \alpha}[u\xi)] \der{}{\xi^\alpha} + b^{pq \alpha}_s[u(\xi)] \pder{u^s}{\xi^\alpha} \right) \fder{u^j(y)}{u^q(\xi)}
        \\ = \int \D \xi \delta(x-\xi) \left[ g^{ij \alpha}[u(\xi)] \partial_\alpha \delta(y-\xi) + b^{ij \alpha}_s[u(\xi)] u^s_\alpha \delta(y- \xi) \right] 
        \\ = g^{ij \alpha} [u(x)] \delta_\alpha(x-y) + b_k^{ij \alpha} [u(x)] u_\alpha^k(x) \delta(x-y) \:.
    \end{align}
\end{proof}

\begin{proposition}[Time derivative of the field variables]
    The Hamiltonian system of hydrodynamic type reads as
    \begin{align}
        u^i_t(x) = \set{u^i,H} \:.
    \end{align}
\end{proposition}
\begin{proof}
    \begin{align*}
        \set{u^i(x),H} 
        =& \int \D \xi \fder{u^i(x)}{u^p(\xi)} \left[ g^{pq \alpha}[u(\xi)] \der{}{\xi} + b^{pq \alpha}_m [u(\xi)] \pder{u^m}{\xi^\alpha} \right] \fder{H}{u^q(\xi)} 
        \\ =& \int \D \xi \int \D y \delta(x-\xi) \left[  g^{ij \alpha} [u(\xi)] \der{}{\xi} \pder{h}{u^j}(\xi) \delta(y-\xi) + b^{ij \alpha}_k [u(\xi)] u^k_\alpha \pder{h}{u^j} (\xi) \delta(y-\xi) \right]  
        \\ =& \left[ g^{ij \alpha} [u(x)] \pder{^2 h}{u^j \partial u^k}(x)  + b^{ij \alpha}_k(u(x)) \pder{h}{u^j}(x) \right] \pder{u^k}{x^\alpha} \:.
    \end{align*}
\end{proof}
\todo[inline]{Dokončit.}

Later we shall show that the Dubrovin-Novikov bracket defined above can be seen as the Poisson bracket (of hydrodynamic type), i.e. satisfies  skew-symmetry, Leibniz rule and Jacobi identity. In fact, this will be the key theorem of this chapter.

\section{One-dimensional case}

In this section we first consider the one-dimensional case in which the unknown functions $u^i$ depend on only two variables $(t,x)$. The hamiltonian system is then
\begin{align}
    \pder{u^i}{t} (t,x) =&
    \left[ g^{ij} [u(t,x)] \ppder{h(u)}{u^j}{u^k} + b_k^{ij} [u(t,x)] \pder{h(u)}{u^j} \right] \pder{u^k}{x}(t,x) \:, 
\end{align}
and the Dubrovin-Novikov bracket is of the form
\begin{align}
    \set{I_1,I_2} = \int \D x
    \left[ \frac{\delta I_1}{\delta u^p(x)} \left( g^{pq}[u(x)] \der{}{x} + b^{pq}_s[u(x)] \pder{u^s}{x} \right) \frac{\delta I_2}{\delta u^q(x)} \right] \:. \label{eq:Dubrovin-Novikov bracket 1D}
\end{align}
In particular
\begin{align}
    \label{eq:Poisson1D}
    \set{u^i(x), u^j(y)} =& g^{ij} [u(x)] \partial_x \delta(x-y) + b_k^{ij} [u(x)] u^k_x \delta(x-y) \:. 
\end{align}

Our goal is to specify the conditions for the Dubrovin-Novikov bracket to be Poisson bracket. The simplest property is the Leibniz rule, which is always satisfied.

\todo[inline]{Jakou to má souvislost s Leibnizem $\set{fg,h} = f \set{g,h} + \set{f,h} g $? Není toto spíš vlastnost "transformace Poissonova bivektoru jakožto tensoru"?}
\begin{proposition}[Leibniz rule for Dubrovin-Novikov bracket]
    \begin{align}
        \label{eq:transformace-zavorka}
        \set{v^p(u^i(x)),v^q(u^j(y))} = \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \set{u^i(x),u^j(y)} \:. 
    \end{align}
\end{proposition}
\begin{proof}
    The coordinates are written as functionals in the form
    \begin{align}
        v^p(u^i(x)) = \int \D x' v^p(u^i(x')) \delta (x-x') \:.
    \end{align}
    Applying this to the definition of the Dubrovin-Novikov bracket \eqref{eq:Poisson1D}, we have
    \begin{align}
        \set{v^p(u^i(x)),v^q(u^j(y))} 
        =& \int \D x' \int \D y' \underbrace{\fder{v^p}{u^i(x')} }_{\pder{v^p}{u^i}(x') \delta(x-x')} \set{u^i(x'),u^j(y')} \underbrace{\fder{v^q}{u^j(y')} }_{\pder{v^q}{u^j}(y') \delta(y-y')}
        = \\ =& \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \set{u^i(x),u^j(y)} \:.
    \end{align}
\end{proof}

Skew-symmetry and Jacobi identity for the bracket are not so easy to investigate. In order to do that, we introduce one more class of functions.

We say that the Poisson bracket is non-degenerate if $\det(g^{ij}) \neq 0$. We shall show later that the non-degeneracy is invariant under the transformation of the coordinates. In that case, we can naturally define its inverse $g_{ij} \coloneqq (g^{mn})^{-1}$.

Let $g^{ij}(u)$ be non-degenerate. Then we can define functions $\Gamma^{i}_{jk}(u)$ as
\begin{align}
    \Gamma^i_{jk}(u) \coloneqq - g_{js}(u) b^{s i}_k(u) \:. \label{eq:Gamma=g*b}
\end{align}
Note that this relation allows to decompose
\begin{align}
    b_k^{ij}(u) = -g^{is}(u) \Gamma^j_{sk}(u) \:. \label{eq:b=g*Gamma}
\end{align}
The choice of denotation $g^{ij}(u)$ and $\Gamma^{i}_{jk}(u)$ has its purpose. We shall show soon that these are in fact the metric and afinne coefficients, respectively, on $M$.


\begin{proposition}[Transformation of $g^{ij}$ and $\Gamma^i_{jk}$] \label{prop:transoformace}
    Let $u^i \mapsto v^a$ be the smooth change of variables. Then
    \begin{enumerate}
        \item The $g^{ij}$ coefficients transform as the (2,0) tensors, i.e. 
        \begin{align}
            g^{pq}(v) = \pder{v^p}{u^i} \pder{v^q}{u^j} g^{ij}[u(v)] \:. \label{eq:transformace-metrika}
        \end{align}
        \item The $\Gamma^i_{jk}$ coefficients  transform like Christoffel symbols, i.e.
        \begin{align}
            \Gamma^p_{qr} (v) = \pder{v^p}{u^i} \pder{u^j}{v^q} \pder{u^k}{v^r} \Gamma^i_{jk}(u) + \pder{v^p}{u^i} \ppder{u^i}{v^q}{v^r} \:. \label{eq:transformace-konexe}
        \end{align}
    \end{enumerate}
\end{proposition}

\begin{proof}
    \begin{enumerate}
        \item Let us apply the transformation equation \eqref{eq:transformace-zavorka} to the definition of the Dubrovin-Novikov bracket \eqref{eq:Poisson1D}. We get 
        \begin{align}
            g^{pq}[v(u(x))] \partial_x \delta(x-y) + b^{pq}_s[v(u(x))] \pder{v^s}{u^k}(x) \pder{u^k}{x} \delta(x-y) \nonumber
            \\ = \pder{v^p}{u^i}(x) \pder{v^q}{u^j}(y) \left[ g^{ij}[u(x)] \partial_x \delta(x-y) + b^{ij}_k[u(x)] \pder{u^k}{x} \delta(x-y) \right] \:. \label{eq:dosad}
        \end{align}
        From now on (for readibility) we denote 
        \begin{align}
            T^a_k(x) := \pder{v^a}{u^k}(x) \:.
        \end{align}
        We apply Dirac identity (Lemma \vref{lemma:delta}) to $T^q_j(y) \partial_x \delta(x-y)$ on the right-hand side of \eqref{eq:dosad}. Hence all functions are then of variable $x$, from now on we shall not write it explicitely. We have
        \begin{align}
            g^{pq}(v) \partial_x \delta(x-y) + b^{pq}_n(v) T^n_j \pder{u^j}{x} \delta(x-y) \nonumber
            \\ = T^p_i T^q_j g^{ij}(u) \partial_x \delta(x-y) 
            + \left( \ppder{v^q}{u^j}{u^k} + T^p_i T^q_j b^{ij}_k \right) \pder{u^k}{x} \delta(x-y) \:. \label{eq:porovnani}
        \end{align}
        The terms with $\partial_x \delta$ must be equal to each other, as must $\delta$ terms. From $\partial_x \delta$ terms we get
        \begin{align}
            g^{pq}(v) = T^p_i T^q_j g^{ij}(u) \:,
        \end{align}
        which is the transformation relation for $g$.

        \item From $\delta$ terms in \eqref{eq:porovnani}, we get
        \begin{align}
            b^{pq}_n(v) T^n_k =
            b^{ij}_k(u) T^p_i T^q_j + g^{ij}(u) T^p_i \ppder{v^q}{u^i}{u^k}
        \end{align}
        and after \eqref{eq:b=g*Gamma}
        \begin{align}
            - g^{ps}(v) \Gamma^{q}_{sn}(v) T^n_k =
            - g^{il}(u) \Gamma^j_{lk}(u) T^p_i T^q_j + g^{ij}(u) T^p_i \ppder{v^q}{u^i}{u^k} \:.
        \end{align}
        On the left-hand side we use the transformation of $g$ \eqref{eq:transformace-metrika}
        \begin{align}
            -g^{ij}(u) \Gamma^q_{sm}(v) T^p_i T^s_j T^m_k = - g^{ij}(u) \Gamma^l_{jk} T^p_i T^q_l + g^{ij}(u) \ppder{v^q}{u^i}{u^k} T^p_i 
        \end{align}
        and after vectoring out $g^{ij}(u) T^p_i$
        \begin{align}
            \Gamma^l_{jk}(u) T^q_l = \Gamma^q_{sm}(v) T^s_j T^m_k + \ppder{v^q}{u^i}{u^k} \:.
        \end{align}
        All that remains is to multiply this equation with $(T^{-1})^a_q$ and we get the final transformation relation for $\Gamma$
        \begin{align}
            \Gamma^a_{jk}(u) = \Gamma^q_{sm}(v) \pder{v^s}{u^j} \pder{v^m}{u^k} \pder{u^a}{v^q} + \ppder{v^q}{u^i}{u^k} \pder{u^a}{v^q} \:.
        \end{align}
    \end{enumerate}
\end{proof}



\section{Dubrovin-Novikov theorem}

Let us summarize, what we have investigated so far. We have defined Dubrovin-Novikov bracket in the way that it satisfies the Leibniz rule. It remains to investigate the skew-symmetry and Jacobi identity. For that, we have defined $g^{ij}$ and $\Gamma^i_{jk}$, which transform like tensors and Christoffel symbols, respectively. It remains to show that $g^{ij}$ is indeed symmetric and $\Gamma^i_{jk}$ is the Levi-Civita connection, i.e. the corresponding covariant derivative $\nabla_j$ has zero torsion and is compatible with the metric.

We are now ready to prove the key theorem of this chapter which shows that these properties are indeed equivalent. Moreover, the corresponding covariant derivative has zero curvature, which indicates that the phase space $M$ is in fact Euclidean space.

\begin{theorem}[Dubrovin, Novikov;\cite{Dubrovin-Novikov}] \label{Theorem-Dubrovin-Novikov-1D}
    Let $g^{ij}$ be non-degenerate. Then the Dubrovin-Novikov bracket \eqref{eq:Poisson1D} is a Poisson bracket with skew-symmetry, Leibniz rule and Jacobi identity if and only if these three conditions are satisfied:
    \begin{enumerate}
        \item $g^{ij} = g^{ji}$, that is, $g^{ij}$ is a metric on the phase space $M$.
        \item $\Gamma^{i}_{jk} = \Gamma^i_{kj}$, that is, $\Gamma^{i}_{jk}$ are Christoffel symbols corresponding to the Levi-Civita covariant derivative compatible with $g^{ij}$.
        \item The covariant derivative corresponding to $\Gamma^{i}_{jk}$ has zero curvature.
    \end{enumerate}
\end{theorem}

\begin{corollary} \label{Corollary: existence of flat coordinates}
    There exist local coordinates $w^i = w^i(u^1, \dots, u^N)$, $i = 1, \dots, N$ such that the metric is flat:
    \begin{align}
        g^{ij}(w) = \eta^{ij} = \const \:, \quad \Gamma^i_{jk} (w) = 0 \:.
    \end{align}
    In these flat coordinates is the Dubrovin-Novikov bracket reduced to the constant form
    \begin{align}
        \set{w^i(x),w^j(y)} = \eta^{ij} \partial_x \delta(x-y) \:.
    \end{align}
    The only local invariant of the Poisson bracket is the signature of the metric $g^{ij}(u)$.
\end{corollary}

Due to the relatively large length of the proof we divide it into four steps.
\begin{itemize}
    \item \textbf{Step 1:} We show that the skew-symmetry of the bracket implies the symmetry of the metric $g^{ij}$ and compatibility with the Christoffel symbols $\Gamma^i_{jk}$.
    \item \textbf{Step 2:} We formulate the conditions under which the Jacobi identity for the bracket holds.
    \item \textbf{Step 3:} We show that two of these conditions implies the zero torsion and zero curvature of the covariant derivative associated to $\Gamma^i_{jk}$. That finishes the implication in one direction.
    \item \textbf{Step 4:} We prove the converse implication via the existence of the flat coordinates.
\end{itemize}

\begin{lemma}[Step 1: skew-symmetry] \label{lemma:skew-symmetry}
    If the skew-symmetry of the Dubrovin-Novikov bracket holds, then
    \begin{align}
        &g^{ij} = g^{ji} \:, \label{eq:skew-1}\\
        &g^{ij}_{,m} = b^{ij}_m + b^{ji}_m \label{eq:skew-2} \:.
    \end{align}
\end{lemma}
\begin{proof}
    The skew-symmetry reads as
    \begin{align}
        \set{u^i(x),u^j(y)} + \set{u^j(y),u^i(x)} = 0 \:.
    \end{align}
    According to the definition, the exact form of the second bracket is
    \begin{align}
        \set{u^j(y),u^i(x)} =  g^{ji}[u(y)] \partial_x \delta(y-x) + b^{ji}_k[u(y)] \pder{u^k}{y} \delta(y-x) \:.
    \end{align}
    Let us apply Dirac identites (Lemma \vref{lemma:delta}) on $g^{ji}[u(y)]\partial_x \delta(y-x)$. We get
    \begin{align}
        \set{u^j(y),u^i(x)} =& \nonumber \\ 
        = - g^{ji} [u(x)] \partial_x \delta(x-y) -& \pder{g^{ji}}{u^k}[u(x)] \pder{u^k}{x} \delta(x-y) + b^{ji}_k[u(x)] \pder{u^k}{x} \delta(x-y)
        \:.
    \end{align}
    The skew-symmetry is then
    \begin{align}
        0 = \set{u^i(x),u^j(y)} + \set{u^j(y),u^i(x)} = \nonumber
        \\= \left[ g^{ij}[u(x)]  - g^{ji}[u(x)] \right] \partial_x \delta(x-y) + \left[ b^{ij}_k - \pder{g^{ji}}{u^k}  + b^{ji}_k  \right] \pder{u^k}{x} \delta(x-y) \:.
    \end{align}
    The right-hand side is equal to zero if and only if
    \begin{align}
        g^{ij}(u) = g^{ji}(u) \:, \label{eq:Th.Novikov-symetrie} \\
        \pder{g^{ij}}{u^k}(u) = b^{ij}_k(u) + b^{ji}_k(u)  \:. \label{eq:Th.Novikov-konexe}
    \end{align}
\end{proof}

\begin{lemma}[Step 2: Jacobi identity] \label{lemma:Jacobi}
    The Jacobi identity for the bracket is equivalent to 
    \begin{align}
        &b^{ij}_m g^{mk} = b^{ik}_m g^{mj} \:, \label{eq:Jacobi-1}\\ 
        &b^{ij}_{m} b^{mk}_s - b^{ik}_m b^{mj}_s = g^{mi} \left( b^{jk}_{s,m} - b^{jk}_{m,s} \right) \:, \label{eq:Jacobi-2}\\
        \sum_{(i,j,k)}& \left[ (b^{ij}_{t,p} - b^{ij}_{p,t}) b^{tk}_s + (b^{ij}_{t,s} - b^{ij}_{s,t}) b^{tk}_p \right] = 0 \:, \label{eq:Jacobi-3}
    \end{align}
    where the summation $\sum_{(i,j,k)}$ means summation over cyclic permutations of indices $i,j,k$.
\end{lemma}

\begin{proof}
    We denote
    \begin{align}
        \mathcal J^{ijk}(x,y,z) = J^{ijk}(x,y,z)+ J^{jki}(y,z,x)+ J^{kij}(z,x,y) = 0
    \end{align}
    where
    \begin{align}
        J^{ijk}(x,y,z) = \set{\set{u^i(x),u^j(y)}, u^k(z)} \:.
    \end{align}

    From now on we shall use the abbreviated notation
    \begin{align}
        g^{ij}_{,m} = \pder{g^{ij}}{u^m} \:, \quad b^{ij}_{k,m} = \pder{b^{ij}_k}{u^m} \:, \quad u^k_x = \pder{u^k}{x}  \:.
    \end{align}
    One of the Jacobiators reads as
    \begin{align*}
        J^{ijk}(x,y,z) =
        \int \D \xi \fder{\set{u^i(x),u^j(y)}}{u^m(\xi)} 
        \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \fder{u^k(z)}{u^n(\xi)}  \:.
    \end{align*}
    The functional derivatives are
    \begin{align}
        \fder{u^k(z)}{u^n(\xi)} = \delta^k_n \delta(z-\xi)
    \end{align}
    and 
    \begin{align}
        \fder{\set{u^i(x),u^j(y)}}{u^m(\xi)} = \fder{}{u^m(\xi)} \left[ g^{ij}(x) \partial_x \delta(x-y) + b^{ij}_k(x) \partial_x u^k \delta(x-y)\right] = 
        \nonumber
        \\ = \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \right] \delta (x-\xi) - b^{ij}_m(x) \delta(x-y) \partial_\xi \delta(x-\xi) \:.
    \end{align}
    We have
    \begin{align}
        J^{ijk}(x,y,z) = J_1^{ijk}(x,y,z) + J_2^{ijk}(x,y,z) 
    \end{align}
    where
    \begin{align*}
        & J_1^{ijk}(x,y,z) = \int \D \xi  \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) \delta(x-\xi) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \delta(x-\xi) \right]   \\ 
        & \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \delta^k_n \delta(z-\xi)  
    \end{align*}
    and 
    \begin{align*}
        J_2^{ijk}(x,y,z) = - \int \D \xi b^{ij}_m(x) \delta(x-y) \partial_\xi \delta(x-\xi) \left[ g^{mn}(\xi) \partial_\xi + b^{mn}_p \partial_\xi u^p \cdot \right] \delta^k_n \delta(z-\xi)  \:.
    \end{align*}
    In $J_1$ we use integration with $\delta(x-\xi)$ and get rid of the integral:
    \begin{align*}
        J_1^{ijk}(x,y,z) =& \left[ g^{ij}_{,m}(x) \partial_x \delta(x-y) + b^{ij}_{k,m}(x) u^k_x \delta(x-y) \right] 
        \left[ g^{mk}(\xi) \partial_x + b^{mk}_p \partial_x u^p \cdot \right] \delta(z-x)
        \\
        =& \left[ g^{ij}_{,m} g^{mk} \partial_x \delta(x-y) + b^{ij}_{k,m} g^{mk} u^k_x \delta(x-y) \right] \partial_x \delta(z-x) + 
        \\
        +& \left[ g^{ij}_{,m} b^{mk}_p u^p_x \partial_x \delta(x-y) + b^{ij}_{k,m} b^{mk}_p u_x^p  u_x^k \delta(x-y) \right] \delta(z-x) \:.
    \end{align*}

    In $J_2$ we first apply integration by parts to get rid of $\partial_\xi \delta(x-\xi)$ and then integrate:
    \begin{align*}
        J_2^{ijk}(x,y,z) = \int \D \xi b^{ij}_m(x) \delta(x-y) \delta(x-\xi) \partial_\xi \left[ g^{mk}(\xi) \partial_\xi \delta(z-\xi) + b^{mk}_p \partial_\xi u^p \delta(z-\xi) \right]
        \\ = b^{ij}_m(x) \delta(x-y) \partial_x \left[ g^{mn}(x) \partial_x \delta(z-x) + b^{mn}_p \partial_x u^p \delta(z-x) \right]
        \\ = b^{ij}_m(x) \delta(x-y) \big[ g^{mk}_{,s} u^s_x \partial_x \delta (z-x) + g^{mk} \partial_x \partial_x \delta (z-x) 
        \\ + b^{mk}_{p,s}(x) u^s_x u^p_x \delta (z-x) + b^{mn}_{p}(x) u^p_{xx} \delta (z-x) + b^{mk}_{p}(x) u^p_x \partial_x \delta (z-x) \big]
    \end{align*}

    \begin{align*}
        J_2^{ijk}(x,y,z) =& b^{ij}_m g^{mk}_{,s} u^s_x \delta (x-y) \partial_x \delta (z-x) 
        + b^{ij}_m g^{mk} \delta(x-y) \partial_x \partial_x \delta (z-x) 
        \\ +& b^{ij}_m b^{mk}_{p,s} u^s_x u^p_x \delta (x-y) \delta (z-x)
        + b^{ij}_m b^{mn}_p u^p_{xx} \delta (x-y) \delta(z-x) 
        \\ +& b^{ij}_m b^{mk}_p u^p_x \delta(x-y) \partial_x \delta(z-x) \:.
    \end{align*}

    In total we end with terms
    \begin{align}
        J^{ijk}(x,y,z) =& 
        E^{ijk}(x) \delta(x-y) \delta(z-x) 
        \\+& F^{ijk}(x) \delta(x-y) \partial_x \delta(z-x) \:,
        \\+& G^{ijk}(x) \partial_x \delta(x-y) \delta (z-x) \:,
        \\+& H^{ijk}(x) \partial_x \delta(x-y) \partial_x \delta (z-x) \:,
        \\+& I^{ijk}(x) \delta(x-y) \partial_x \partial_x \delta (z-x) \:,
    \end{align}
    where
    \begin{align}
        E^{ijk} =& (b^{ij}_m b^{mk}_{p,s} + b^{ij}_{s,m} b^{mk} ) u^p_x u^s_x + b^{ij}_m b^{mk}_p u^p_{xx} \:, \\
        F^{ijk} =& (b^{ij}_{s,m} g^{mk} + g^{mk}_{,s} b^{ij}_m + b^{ij}_m b^{mk}_s)u_x^s \:, \\
        G^{ijk} =& g^{ij}_{,m} b^{mk}_s u^s_x \:,\\
        H^{ijk} =& g^{ij}_{,m} g^{mk} \:,\\
        I^{ijk} =& b^{ij}_m g^{mk} \:.
    \end{align}
    Now the procedure is the following: firstly we have to add the cyclic permutations $J^{jki}(y,z,x)$ and $J^{kij}(z,x,y)$ to obtain $\mathcal J^{ijk}(x,y,z)$. Secondly, the resulting generalized function $\mathcal J^{ijk}(x,y,z)$ is equal to zero, i.e.
    \begin{align}
        \dual{\mathcal J^{ijk}(x,y,z)}{p_i(x)q_j(y)r_k(z)} = 0
    \end{align}
    or in the integral notation 
    \begin{align}
        \iiint \D x \D y \D z J^{ijk}(x,y,z) p_i(x)q_j(y)r_k(z) = 0 \:.
    \end{align}
    We want to reduce this integral into a one-dimensional integral
    \begin{align}
        \int \D x \sum_{a,b = 0}^2 A^{ijk}_{ab} p_i(x) q^{(a)}_j(x) r^{(b)}_k (x) \:,
    \end{align}
    where $f^{(a)}$ means the $a$-th derivative. This integral is equal to zero if and only if
    \begin{align}
        A^{ijk}_{ab} = 0 \quad \forall a,b = 0,1,2 \:.
    \end{align}
    From this condition we shall obtain the zero torsion and curvature.
    We illustrate the procedure of reduction to the one-dimensional integral on one particular expression. For instance, we have
    \begin{align*}
        \int \big[ F^{ijk}(x) \delta(x-y) \partial_x \delta(z-x) 
        + F^{jki}(y) \delta(y-z) \partial_y \delta(x-y) \\
        + F^{kij}(z) \delta(z-x) \partial_z \delta(y-z) \big] \,
        p_i(x) q_j(y) r_k(z) \,\D x \D y \D z \:.
    \end{align*}
    We use the antisymmetry $
        \partial_x \delta(z-x) = - \partial_z \delta (z-x)$
    and similarly in each term and then get rid of the integrals with $\D y$ and $\D z$, obtaining
    \begin{align*}
        \int \D x F^{ijk}(x) p_i q_j r'_k + \int \D x F^{jki}(x)  p'_i q_j r_k +
        \int \D x F^{kij}(x) p_i q'_j r_k \:.
    \end{align*}
    In the term containing $p'_i$ we perform integration by parts. The result is
    \begin{align*}
        \int \D x (F^{ijk}-F^{jki}) p_i q_j  r'_k +
        \int \D x (F^{kij}-F^{jki}) p_i q'_j r_k -
        \int \D x \partial_x F^{jki} p_i q_j r_k \:.
    \end{align*}
    In this particular case, we end up with terms, witch contribute to $A^{ijk}_{01}$, $A^{ijk}_{10}$ and $A^{ijk}_{00}$, respectively. Other terms in $\mathcal J^{ijk}(x,y,z)$ are handled in the similar way.

    The list of the resulting functions is the following:
    \begin{align}
        A_{00}^{ijk} =& E^{ijk} + E^{kij} + E^{jki} + \partial_x \partial_x I^{jki} - \partial_x F^{jki} - \partial_x G^{kij} \:, \label{eq:A00}\\
        A_{01}^{ijk} =& F^{ijk} - F^{jki} + G^{jki} - G^{kij} - \partial_x H^{jki} + 2 \partial_x I^{jki} \:, \label{eq:A01}\\
        A_{10}^{ijk} =& F^{kij} - F^{jki} + G^{ijk} - G^{kij} - \partial_x H^{kij} + 2 \partial_x I^{jki} \:, \label{eq:A10}\\
        A_{11}^{ijk} =& H^{ijk} - H^{jki} - H^{kij} + 2 \partial_x I^{jki} \:, \label{eq:A11} \\
        A_{02}^{ijk} =& I^{ijk} + I^{jki} - H^{jki}\:, \label{eq:A02}\\
        A_{20}^{ijk} =& I^{jki} + I^{kij} - H^{kij}\:, \label{eq:A20} \\
        A^{ijk}_{12} =& A^{ijk}_{21} = 0 \:.
    \end{align}
    Note that \eqref{eq:A20} is just a cyclic permutation of \eqref{eq:A02}. If we also use the symmetry conditon \eqref{eq:skew-1} and the compatibility condition \eqref{eq:skew-2}, then the equation \eqref{eq:Jacobi-1} follows from \eqref{eq:A02}. Equation \eqref{eq:A00} has the form
    \begin{align}
        A_{00}^{ijk} = B^{ijk}_s u^s_{xx} + C^{ijk}_{sp} u^s_x u^p_x \:.
    \end{align}
    The expression on the right hand side is zero if and only if both $B^{ijk}_s$ and $C^{ijk}_{sp} = 0$. From the function $B^{ijk}_s$ beeing zero follows \eqref{eq:Jacobi-2} and from $C^{ijk}_{sp}$ follows \eqref{eq:Jacobi-3}. Finally, equations \eqref{eq:A01}, \eqref{eq:A10} and \eqref{eq:A11} are satisfied automatically if \eqref{eq:A00} and \eqref{eq:A02} hold.
\end{proof}

It is useful to write once more all the equations from lemmas \vref{lemma:skew-symmetry} and \vref{lemma:Jacobi} together. Since they first appeared in \cite{Grinberg}, we refer to them as to the Grinberg conditions.
\begin{lemma}[Grinberg conditions; \cite{Grinberg}] \label{Grinberg conditions}
    If the Dubrovin-Novikov bracket satisfies skew-symmetry and Jacobi identity, then the following conditions hold:
    \begin{align}
        &g^{ij} = g^{ji} \:, \label{eq:Grinberg-1}\\
        &g^{ij}_{,m} = b^{ij}_m + b^{ji}_m \:, \label{eq:Grinberg-2}\\
        &b^{ij}_m g^{mk} = b^{ik}_m g^{mj} \:, \label{eq:Grinberg-3}\\
        &b^{ij}_{m} b^{mk}_s - b^{ik}_m b^{mj}_s = g^{mi} \left( b^{jk}_{s,m} - b^{jk}_{m,s} \right) \:, \label{eq:Grinberg-4}\\
        \sum_{(i,j,k)}& \left[ (b^{ij}_{t,p} - b^{ij}_{p,t}) b^{tk}_s + (b^{ij}_{t,s} - b^{ij}_{s,t}) b^{tk}_p \right] = 0 \:. \label{eq:Grinberg-5}
    \end{align}
\end{lemma}

Up to now, we did not assume non-degeneracy of the bracket. Note that non-degeneracy allows to use $\Gamma^{i}_{jk} = - g_{js} b^{si}_k$, since in the degenerate case the inverse $g_{js}$ does not exist. If we reformulate the Grinberg conditions in terms of $\Gamma^{i}_{jk}$, we get the compatiblity, zero torsion and curvature.

\begin{lemma}[Step 3: Zero curvature and torsion]
    If the Grinberg conditions hold and the $g^{ij}$ is non-degenerate, then $g^{ij}$ is a metric, the covariant derivative $\nabla_i$ associated to $\Gamma^{i}_{jk}$ is compatible with $g^{ij}$ and it has zero torsion and curvature, i.e. $\nabla_i$ is a Levi-Civita covariant derivative with zero curvature.
\end{lemma}
\begin{proof}
    Equation \eqref{eq:Grinberg-1} says that $g^{ij}$ is a symmetric tensor. By assumption $\det g^{ij}$ is non-degenerate, so it defines a metric structure on $M$. Equation \eqref{eq:Grinberg-2} is equivalent to
    \begin{align}
        g^{ij}_{,k} + g^{is} \Gamma_{sk}^j + g^{sj} \Gamma_{sk}^i = 0 \:.
    \end{align}
    If $\nabla_k$ is the covariant derivative corresponding to $\Gamma^i_{jk}$, then $\nabla_k g^{ij} = 0$. So $\Gamma_{ij}^k$ are affine connection coefficients, compatible with $g^{ij}$.

    To obtain zero torsion, we use \eqref{eq:Grinberg-3}, which reads as 
    \begin{align}
        g^{mk} g^{sj} \Gamma^i_{ms} = g^{mk} g^{sj} \Gamma^i_{sm} \:.
    \end{align}
    Hence the Christoffel symbols are symmetric in the lower indices, which implies that the covariant derivative corresponding to them has zero torsion.

    Zero curvature follows from \eqref{eq:Grinberg-4}, which reads as
    \begin{align}
        g^{in} g^{ml} (\Gamma^j_{nm} \Gamma^{k}_{ls} - \Gamma^k_{nm} \Gamma^j_{ls}) = - g^{im} \pder{}{u^m} \left( g^{jl} \Gamma^k_{ls}\right) + g^{im} \pder{}{u^s}\left( g^{jl} \Gamma^k_{lm}\right) \:,
    \end{align}
    and reduces to
    \begin{align}
        g^{im} g^{jn} \left( \Gamma^{l}_{nm} \Gamma^{k}_{ls} - \Gamma^{l}_{ns} \Gamma^k_{lm} + \Gamma^k_{nm,s} - \Gamma^k_{ns,m} \right) = 0 \:.
    \end{align}
    This means that the Riemann tensor $R\indices{_n_m^k_s}$ is equal to zero.
\end{proof}

The final step is to prove the converse statement and the corollary \vref{Corollary: existence of flat coordinates}, which turns out to be very simple due to the non-degeneracy of the bracket. 

\begin{lemma}[Step 4: The converse statement]
    If $g^{ij}$ is non-degenerate metric and $\Gamma^i_{jk}$ correspond to the Levi-Civita covariant derivative $\nabla$ with zero curvature, then the Dubrovin-Novikov bracket is a Poisson bracket, i.e. it satisfies skew-symmetry, Leibniz rule and Jacobi identity.
\end{lemma}

\begin{proof}
    If $\nabla$ has zero torsion and curvature, there are coordinates $w^i=w^i(u^1,\dots,u^N)$ for $i=1,\dots,N$ such that $g^{ij} \eqqcolon \eta^{ij} =\const$ a $b^{ij}_k = 0$. In these coordinates
    \begin{align}
        \set{w^i(x),w^j(y)} = \eta^{ij} \partial_x \delta(x-y) \:.
    \end{align}
    Jacobi identity, skew-symmetry and Leibniz rule are for that bracket satisfied trivially due to the antisymmetry of the delta distribution.
\end{proof}
Thus the proof of the Dubrovin-Novikov theorem \vref{Theorem-Dubrovin-Novikov-1D} is finished.

\section{Some consequences of Dubrovin-Novikov theorem}

It follows from the theorem \vref{Theorem-Dubrovin-Novikov-1D} that we can write the original functions $f^{i}_j$ in \eqref{eq:h-system} by the Laplace-Beltrami operator.

\begin{proposition}[Hamiltonian system by the Laplace operator]
    Given Hamiltonian system of hydrodynamic type
    \begin{align}
        \pder{u^i}{t} = f^i_k(u) \pder{u^k}{x} \:, \quad f^i_k(u) = g^{ij}(u) \ppder{h}{u^j}{u^k} - g^{is}(u) \Gamma^j_{sk}(u) \pder{h}{u^j} \:, \label{eq:hamiltonovsky-system}
    \end{align}
    one can write
    \begin{align}
        f^i_k(u) = \nabla^i \nabla_k h(u) \:, 
    \end{align}
    where $\nabla_j$ is Levi-Civita covariant derivative compatible with $g_{ij}$ and $\nabla^i = g^{is} \nabla_s$. 
\end{proposition}
\begin{proof}
    Since $h$ is ordinary function, application of $\nabla_k$ is just the partial derivative w.r.t. $u^k$:
    \begin{align}
        \nabla_k h(u) =& \pder{h}{u^k} \:.
    \end{align}
    Now this term $\pder{h}{u^k}$ is a covector, so $\nabla_i$ is given by the partial derivative and the $\Gamma_{ij}^k$ part by
    \begin{align}
        \nabla^i \nabla_k h(u) =& g^{is} \nabla_s \pder{h}{u^k} = g^{is} \left( \ppder{h}{u^s}{u^k} - \Gamma^j_{sk} \pder{h}{u^j} \right) = f^i_k(u) \:.
    \end{align}
\end{proof}

Another direct application of the theorem \vref{Theorem-Dubrovin-Novikov-1D} is the sufficient condition for the determinating, whether is a given system Hamiltonian or not.

\begin{theorem}[The sufficient condition for a system to be Hamiltonian]
    
    A system of hydrodynamic type 
    \begin{align}
        u^i_t = f^i_j(u) u^j_x \:,
    \end{align}
    is Hamiltonian if and only if there is a non-degenerate metric $g^{ij}(u)$ and corresponding covariant derivative $\nabla_j$, such that
    \todo[inline]{V tomto vztahu nesedí indexy.}
    \begin{align}
        g^{ij} f^k_j = g_{jk} f^k_i \:, \label{eq:gf=gf} \\
        \nabla_i f^k_j = \nabla_j f^k_i \label{eq:nablaf} \:.
    \end{align}
    In particular, \eqref{eq:nablaf} is equivalent to the zero torsion of $\nabla_i$.
\end{theorem}

\begin{proof}
    If the system is Hamiltonian, then $f^k_j = \nabla^k \nabla_j h$ and $\nabla_j$ has zero torsion, that means
    \begin{align}
        \nabla_i f^k_j = g^{km} \nabla_i \nabla_m \nabla_j h = g^{km} \nabla_j \nabla_m \nabla_i h = \nabla_j f^{k}_i \:,
    \end{align}
    and
    \begin{align}
        g^{ij} f^{k}_j = g^{ij} g^{mk} \nabla_m \nabla_j h = \nabla^i \nabla^k h = \nabla^k \nabla_i h
    \end{align}
\end{proof}
